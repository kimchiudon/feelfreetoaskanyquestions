{% include "_header.html" %}

{# =======================
   모드 A: 아직 post가 없을 때 (질문 작성)
   ======================= #}
{% if not post %}
<form action="/posts" method="POST" class="post-form">
  <div class="form-group">
    <label for="question">현정이에게 무엇이든 물어보십시오!</label>
    <textarea id="question" name="question" rows="10" placeholder="질문을 입력하세요..." required></textarea>
  </div>

  <button type="submit">Ask!!</button>
</form>

<a href="/posts" class="back-link">&larr; Back to Home</a>

{# =======================
   모드 B: post가 있을 때 (방금 만든 질문 + 댓글(답변))
   ======================= #}
{% else %}

<article class="post-detail">
  <h1>{{ post.question }}</h1>
  <small>{{ post.created_at.strftime('%Y-%m-%d') }}</small>

  {% if post.content %}
  <div class="post-content">
    {{ post.content | replace('\n', '<br />') | safe }}
  </div>
  {% endif %}
</article>

<section class="comments-section">
  <h3>Answers</h3>

  <div class="comment-list">
    {% if comments %}
      {% for comment in comments %}
      <div class="comment-item">
        <p class="comment-content">{{ comment.content }}</p>
        <small>
          By <strong>{{ comment.user.username }}</strong> on {{ comment.created_at.strftime('%Y-%m-%d') }}
        </small>
      </div>
      {% endfor %}
    {% else %}
      <p>답변을 기다려주십시오.</p>
    {% endif %}
  </div>

  {% if user %}
  <form action="/posts/{{ post.id }}/comments" method="POST" class="comment-form">
    <h4>Leave an Answer</h4>
    <div class="form-group">
      <textarea name="content" rows="4" placeholder="답변을 입력하십시오" required></textarea>
    </div>
    <button type="submit">Submit</button>
  </form>
  {% else %}
  <p><a href="/auth/login">Login</a> to leave a comment.</p>
  {% endif %}
</section>

<a href="/posts" class="back-link">&larr; Back to Home</a>

{% endif %}

{% include "_footer.html" %}
